\chapter{Schemat pobierania obserwacji}
\label{r1}
Gdy rozważamy skończoną populację, należy dokładnie przyjrzeć się schematowi pobierania obserwacji. Jakimi rozkładami są opisane próbki oraz jakie są własności tych rozkładów. Wyznaczymy także przedziały ufności dla proporcji~$p$ w~obu rozkładach. Przy czym, proporcja to stosunek wartości obserwacji do wielkości próbki, gdzie wartość obserwacji to liczba osobników z~badaną cechą w~próbce.


\section{Nieskończona populacja}
Gdy populacja jest bardzo duża, możemy traktować ją jako nieskończoną. Wobec tego losowanie kolejnych elementów próbki jest niezależne, czyli jest to losowanie ze zwracaniem. Zakładamy, że pobierane obserwacje pochodzą z~rozkładu Bernoulliego $\mathcal{B}(n,p)$, gdzie $n$~to rozmiar próby z~nieskończonej populacji, a~$p$~to proporcja zdarzeń sprzyjających w~populacji. Funkcja prawdopodobieństwa zmiennej losowej $X$ z~rozkładu dwumianowego jest równa
\begin{equation}
b(k;n,p) = P(X=k) = \binom{n}{k} p^k (1-p)^{n-k},\ 0\leq k\leq n.
\end{equation}

\section{Skończona populacja}
\label{r1:skonczonapopulacja}
Kiedy rozważamy populację skończoną, kolejne elementy próbki są losowane bez zwracania. Oznacza to, że prawdopodobieństwo sukcesu zmienia się w~trakcie pobierania elementów obserwacji w~zależności od wyboru poprzednich. W~takiej sytuacji próbka pochodzi z~rozkładu hipergeometrycznego $\mathcal{H}(n,M,N)$. Przy czym $n$~jest rozmiarem próbki, $M$~ilością osobników w~populacji z~daną cechą, a~$N$~rozmiarem populacji. Zmienna losowa~$X$ z~rozkładu hipergeometrycznego ma funkcję prawdopodobieństwa określoną wzorem
\begin{equation}
\label{hg}
h(k;n,M,N) = P(X=k) = \frac{\binom{M}{k} \binom{N-M}{n-k}}{\binom{N}{n}},\ L\leq k\leq U,
\end{equation}
gdzie
\begin{equation}
\label{ograniczenia}
L=\max\{0,M-N+n\},\quad U=\min\{n,M\}.
\end{equation}

Zauważmy, że wzór (\ref{hg}) ma prostą interpretację. Klasyczna definicja prawdopodobieństwa określa szansę zajścia zdarzenia~$A$ jako iloraz liczby zdarzeń elementarnych w~$A$ przez liczbę zdarzeń elementarnych w~$\Omega$, czyli $P(A) = |A|/|\Omega|$. W~rozważanym przypadku zdarzeniu~$A$ odpowiada sytuacja, w~której próbka będzie zawierać $k$~osobników z~daną cechą. Zatem ilość zdarzeń elementarnych w~$A$ to iloczyn dwóch kombinacji bez powtórzeń. Mamy: {\small $\binom{M}{k}$} możliwych wyborów $k$ osobników z $M$ posiadających daną cechę oraz {\small $\binom{N-M}{n-k}$} możliwych wyborów $n-k$ osobników z $N-M$ nieposiadających tej cechy. Wobec tego
\begin{equation}
|A| = \binom{M}{k} \binom{N-M}{n-k}.
\end{equation}
Natomiast zbiór wszystkich zdarzeń elementarnych w~$\Omega$ to wybór losowej próbki $n$~osobników z~$N$\dywiz elementowej populacji, wobec tego
\begin{equation}
|\Omega| = \binom{N}{n}.
\end{equation}
Ograniczenia nałożone na~$k$ są również naturalne. Dolne ograniczenie~$L$ jest równe maksimum z~$0$ i~$M-N+n$. Będzie ono niezerowe, gdy $M-N+n>0$. Przekształcając nierówność, otrzymujemy $n>N-M$, czyli rozmiar próbki jest większy od liczby osobników bez badanej cechy w~populacji. W~rezultacie mamy pewność, że w~próbce będzie przynajmniej tyle osobników z~daną cechą, ile wynosi różnica $n-(N-M)$. Ograniczenie górne jest równe minimum z~$n$~i~$M$, co wynika z~faktu, że nie może być więcej osób w~próbce z~daną cechą niż w~całej populacji. Analiza wzoru (\ref{hg}) pokazuje, że rozkład hipergeometryczny jest ściśle związany z~rozmiarem populacji.

\section{Porównanie rozkładów}

Rozkład hipergeometryczny daje bardzo podobne wyniki do rozkładu Bernoulliego, gdy populacja jest duża, albo~próbka stosunkowo mała. Natomiast przy małej populacji i~dużej próbce różnica między tymi rozkładami jest znaczna.

Rozważmy to na medycznym przykładzie. Załóżmy, że jest grupa $20$ osób, które są chore na jakąś bardzo rzadką chorobę oraz że $25\%$ z~nich ma szanse na wyzdrowienie. Chcemy dowiedzieć się, ile osób spośród przebadanych może wyzdrowieć. Weźmy $3$~różne próbki o~wielkościach~$n$ równych odpowiednio $10$, $17$ oraz $20$. Możemy tę sytuację opisać za pomocą rozkładu Bernoulliego, wtedy badana zmienna losowa jest z~rozkładu $\mathcal{B}(n,0.25)$. Drugim sposobem jest rozkład hipergeometryczny $\mathcal{H}(n,5,20)$. Rysunki \ref{pmf10}\ppauza\ref{pmf20} na stronie~\pageref{pmf10} przedstawiają funkcję prawdopodobieństwa dla wymienionych przypadków.

Przeanalizujmy jakie wartości mogą przyjmować zmienne losowe z~obu rozkładów. W~rozkładzie dwumianowym zmienna w~każdym z~przypadków przyjmuje wartości od $0$ do $n$. Na przykład na wykresie \ref{b_pmf10} argumenty funkcji to zbiór $\{0,1,\ldots,9,10\}$. 
Mimo że w populacji maksymalnie może wyzdrowieć $5$ osób, dla rozkładu Bernoulliego prawdopodobieństwo $X=6$ wynosi $0.09$. Przedstawiona rozbieżność wynika z~założenia, że pobieranie próbki to losowanie ze zwracaniem, czyli w~próbce mogą znaleźć się dwie te same osoby. Natomiast w~rozkładzie hipergeometrycznym zmienną losową ograniczają $L$ i~$U$, zdefiniowane wzorem (\ref{ograniczenia}), które uwzględniają wielkość próbki. Porównując, na wykresie \ref{hg_pmf10} zmienna losowa nie przyjmuje wartości większej niż $5$. Dodatkowo na wykresie \ref{hg_pmf17} najmniejszą wartością jest $2$, ponieważ populacja zawiera $15$ osób, które nie wyzdrowieją, zatem w~$17$\dywiz osobowej próbce jest pewne, że przynajmniej dwie będą zdrowe. Kolejne losowania są od siebie zależne, więc nie możemy drugi raz wylosować tej samej osoby.

\begin{diagrams}{b_pmf10}{hg_pmf10}
	\caption{Funkcje prawdopodobieństwa $b(k;10,0.25)$ oraz $h(k;10,5,20)$}
	\label{pmf10}
\end{diagrams}

\begin{diagrams}{b_pmf17}{hg_pmf17}
	\caption{Funkcje prawdopodobieństwa $b(k;17,0.25)$ oraz $h(k;17,5,20)$}
	\label{pmf17}
\end{diagrams}

\begin{diagrams}{b_pmf20}{hg_pmf20}
	\caption{Funkcje prawdopodobieństwa $b(k;20,0.25)$ oraz $h(k;20,5,20)$}
	\label{pmf20}
\end{diagrams}

Różnica między funkcjami prawdopodobieństwa obu rozkładów rośnie wraz ze wzrostem próbki. Skrajny przypadek przedstawia rysunek \ref{pmf20}, na którym próbka równa się populacji. Wykres \ref{hg_pmf20} idealnie obrazuje przypadek $n=N$. Pewne jest to, że w~$20$ osobach będzie dokładnie $5$, które mogą wyzdrowieć. Natomiast na wykresie \ref{b_pmf20} prawdopodobieństwo, że $X=5$ wynosi jedynie $0.2$, ponieważ funkcja prawdopodobieństwa dla rozkładu dwumianowego nie uwzględnia wielkości populacji. Warto również zaznaczyć, że im większa próbka, tym $P(X=5)$ dla rozkładu Bernoulliego jest coraz mniejsze, ponieważ mamy więcej elementów w~obserwacji. Tymczasem dla rozkładu hipergeometrycznego jest odwrotnie, funkcja prawdopodobieństwa dla $k=5$ rośnie, aż w~końcu osiąga wartość $1$. Gdy przebadamy więcej osobników, wzrasta nasza wiedza o~próbce oraz jest bardziej prawdopodobne to, że znajdzie się w~niej aż pięcioro zdrowych pacjentów.

Spójrzmy, jak wyglądają średnia i~wariancja dla rozważanych rozkładów.
Gdy $X\sim\mathcal{B}(n,p)$, to
\begin{equation}
E(X)=np,\quad Var(X)=np(1-p).
\end{equation}
Podczas gdy $X\sim\mathcal{H}(n,M,N)$, to
\begin{equation}
E(X)=n\frac{M}{N},\quad Var(X)=n\frac{M}{N}\left(1-\frac{M}{N}\right)\frac{N-n}{N-1}.
\end{equation}
Parametr $p$ rozkładu dwumianowego odpowiada ilorazowi parametrów $M/N$ w~rozkładzie hipergeometrycznym. Wobec tego średnie obu rozkładów są sobie równe, ale wariancje różni dodatkowy składnik w~rozkładzie hipergeometrycznym $(N-n)/(N-1)$. Przeanalizujmy, jak ten czynnik wpływa na zróżnicowanie rozkładów. Rysunek \ref{var} na stronie~\pageref{var} przedstawia wykresy wariancji dla rozważanego przykładu w~zależności od wielkości obserwacji. W~przypadku rozkładu dwumianowego wariancja stale rośnie wraz ze wzrostem próbki. Ostatecznie, gdy $n=20$ jest ona największa. Jednakże, gdy przebadamy całą populację, oczekiwanym rezultatem jest wartość zerowa wariancji, ponieważ nie ma wtedy losowości. Taki wynik daje nam wykres~\ref{hg_var} na stronie~\pageref{hg_var}. Funkcja na początku rośnie, ale gdy wielkość próbki przekroczy połowę rozmiaru populacji, wariancja zaczyna maleć aż do zera. Odzwierciedla to fakt, że gdy coraz więcej wiemy o~populacji, losowość uzyskanych wyników maleje.


\begin{figure}[h]
	\begin{subdiagrams}{b_var}{hg_var}
	\end{subdiagrams}

	\caption{Wariancja rozkładów Bernoulliego i~hipergeometrycznego w~zależności od rozmiaru próbki}
	\label{var}
\end{figure}

Rozważmy także, jak wyglądają przedziały ufności dla zmiennych losowych z~obu rozkładów. Załóżmy, że unormowana zmienna losowa pochodzi z~rozkładu standardowego normalnego, czyli
\begin{equation}
\frac{X-E(X)}{\sqrt{Var(X)}}\sim \mathcal{N}(0,1).
\end{equation}
Wobec tego dla $X\sim \mathcal{B}(n,p)$, jeśli aproksymujemy go rozkładem normalnym, przedział ufności parametru~$p$ jest w~przybliżeniu równy
\begin{equation}
\left[\, \hat{p}-z_{1-\alpha/2}\sqrt{\frac{\hat{p}(1-\hat{p})}{n}}\, , \,  \hat{p}+z_{1-\alpha/2}\sqrt{\frac{\hat{p}(1-\hat{p})}{n}}\, \right],
\end{equation}
gdzie $z_{1-\alpha/2}$ to kwantyl rozkładu normalnego rzędu~$1-\alpha/2$.
Natomiast dla $X\sim\mathcal{H}(n,M,N)$ przedział ufności proporcji $p=M/N$ to w~przybliżeniu
\begin{equation}
\left[\, \hat{p}-z_{1-\alpha/2} \sqrt{\frac{\hat{p}(1-\hat{p})(N-n)}{n(N-1)}}\, , \, \hat{p} + z_{1-\alpha/2} \sqrt{\frac{\hat{p}(1-\hat{p})(N-n)}{n(N-1)}}\, \right].
\end{equation}
W obu przypadkach estymator $\hat{p}=k/n$, gdzie $k$ to wartość obserwacji.

Kontynuując rozważany przykład, załóżmy teraz, że nie wiemy, ile osób może wyzdrowieć w~całej populacji, ale mamy wyniki badań. W~grupie $10$~osób wyzdrowiały $3$. Chcemy się dowiedzieć, ile osób może wyzdrowieć wśród wszystkich $20$. Podsumowując, znamy parametry $N=20$, $n=10$ i~wartość obserwacji $k=3$, zatem możemy wyznaczyć przedziały ufności dla parametru $p$ w~obu rozkładach. Dla rozkładu dwumianowego
\begin{equation}
p\in \left[\, 0.02 \, , \, 0.58\, \right].
\end{equation}
Natomiast dla rozkładu hipergeometrycznego
\begin{equation}
p\in \left[\, 0.09 \, , \, 0.5\, \right].
\end{equation}
Prawdziwy parametr $p=0.25$ faktycznie zawiera się w~tych przedziałach. Zauważmy, że przedział dla rozkładu Bernoulliego jest szerszy, ze względu na brak skończonej poprawki w~wariancji.




